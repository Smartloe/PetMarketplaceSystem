{% extends "admin/change_list.html" %}
{% block content %}
    <body style="height: 100%; margin: 0">
    <div id="container" style="height: 100%"></div>
    <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
    <script type="text/javascript" src="https://fastly.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <script type="text/javascript">
        var dom = document.getElementById('container');
        var myChart = echarts.init(dom, null, {
            renderer: 'canvas',
            useDirtyRect: false
        });
        var app = {};

        var option;

        myChart.showLoading();
        $.get(
            'https://cdn.jsdelivr.net/gh/longwosion/geojson-map-china@master/china.json',
            function (cnJson) {
                myChart.hideLoading();
                echarts.registerMap('CN', cnJson);
                var data = [
                    {name: '广东省', value: 183},
                    {name: '广西壮族自治区', value: 380},
                    {name: '海南省', value: 749},
                    {name: '贵州省', value: 655},
                    {name: '湖南省', value: 100},
                    {name: '云南省', value: 291},
                    {name: '重庆市', value: 888},
                    {name: '四川省', value: 291},
                    {name: '新疆维吾尔自治区', value: 291},
                    {name: '湖北省', value: 239},
                    {name: '江西省', value: 4},
                    {name: '福建省', value: 89},
                    {name: '台湾省', value: 12},
                    {name: '山东省', value: Math.round(Math.random() * 1000)},
                    {name: '山东省', value: Math.round(Math.random() * 1000)},
                    {name: '山西省', value: Math.round(Math.random() * 1000)},
                    {name: '陕西省', value: Math.round(Math.random() * 1000)},
                    {name: '宁夏回族自治区', value: Math.round(Math.random() * 1000)},
                    {name: '北京市', value: Math.round(Math.random() * 1000)},

                ];
                data.sort(function (a, b) {
                    return a.value - b.value;
                });
                const mapOption = {
                    title: { // 添加标题配置
                        text: '用户来源', // 主标题文本
                        subtext: '吉祥宠物商城注册用户来源', // 副标题文本
                    },
                    visualMap: {
                        left: 'right',
                        min: 50,
                        max: 800,
                        inRange: {
                            // prettier-ignore
                            color: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026']
                        },
                        text: ['High', 'Low'],
                        calculable: true
                    },
                    series: [
                        {
                            id: 'population',
                            type: 'map',
                            roam: true,
                            map: 'CN',
                            animationDurationUpdate: 1000,
                            universalTransition: true,
                            data: data
                        }
                    ]
                };
                const barOption = {
                    title: { // 添加标题配置
                        text: '用户来源', // 主标题文本
                        subtext: '吉祥宠物商城注册用户来源', // 副标题文本
                    },
                    xAxis: {},
                    yAxis: {
                        type: 'category',
                        axisLabel: {
                            rotate: 30
                        },
                        data: data.map(function (item) {
                            return item.name;
                        })
                    },
                    animationDurationUpdate: 1000,
                    series: {
                        type: 'bar',
                        id: 'population',
                        data: data.map(function (item) {
                            return item.value;
                        }),
                        universalTransition: true
                    }
                };
                let currentOption = mapOption;
                myChart.setOption(mapOption);
                setInterval(function () {
                    currentOption = currentOption === mapOption ? barOption : mapOption;
                    myChart.setOption(currentOption, true);
                }, 2000);
            }
        );


        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }

        window.addEventListener('resize', myChart.resize);
    </script>
{% endblock %}